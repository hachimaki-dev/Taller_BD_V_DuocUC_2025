DROP TABLE MENUS CASCADE CONSTRAINTS;
DROP TABLE PLATILLOS CASCADE CONSTRAINTS;
DROP TABLE TIPO_INGREDIENTES CASCADE CONSTRAINTS;
DROP TABLE INGREDIENTES CASCADE CONSTRAINTS;
DROP TABLE MENU_PLATILLOS CASCADE CONSTRAINTS;
DROP TABLE INGREDIENTES_PLATILLOS CASCADE CONSTRAINTS;
DROP TABLE AUDITORIA_MENU CASCADE CONSTRAINTS;
DROP TABLE AUDITORIA_PLATILLO CASCADE CONSTRAINTS;
DROP TABLE STOCK_INGREDIENTES CASCADE CONSTRAINTS;

--Dropeamos productos
DROP TABLE PRODUCTOS CASCADE CONSTRAINTS;


--Creamos tabla menu

CREATE TABLE MENUS(
    id NUMBER PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL
);

--Creamos la tabla
CREATE TABLE PLATILLOS(
    id NUMBER PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL
);

--Crear la tabla para auditar el platillo
CREATE TABLE AUDITORIA_PLATILLO(
    id NUMBER PRIMARY KEY,
    id_platillo NUMBER,
    nombre_antiguo VARCHAR2(50),
    nombre_nuevo VARCHAR2(50),
    accion VARCHAR(10) NOT NULL,
    fecha TIMESTAMP,
    usuario VARCHAR(20),
    FOREIGN KEY (id_platillo) REFERENCES PLATILLOS(id)
);

--CREAMOS LA TABLA TIPO_INGREDIENTES
CREATE TABLE TIPO_INGREDIENTES(
    id NUMBER PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL
);

--Ahora vamos con las tablas pivotes o las relaciones 1 n

--Vamos con la tabla que tiene relacion 1 n
CREATE TABLE INGREDIENTES(
    id NUMBER PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL,
    id_tipo_ingrediente NUMBER,
    FOREIGN KEY (id_tipo_ingrediente) REFERENCES TIPO_INGREDIENTES(id)
);

--CREAMOS LA TABLA PIVOTE
CREATE TABLE MENU_PLATILLOS(
    id_menu NUMBER,
    id_platillo NUMBER,
    PRIMARY KEY (id_menu, id_platillo),
    FOREIGN KEY (id_menu) REFERENCES MENUS(id),
    FOREIGN KEY (id_platillo) REFERENCES PLATILLOS(id)
);

CREATE TABLE INGREDIENTES_PLATILLOS(
    id_ingrediente NUMBER,
    id_platillo NUMBER,
    PRIMARY KEY (id_ingrediente, id_platillo),
    FOREIGN KEY (id_ingrediente) REFERENCES INGREDIENTES(id),
    FOREIGN KEY (id_platillo) REFERENCES PLATILLOS(id)
);

COMMIT;


--CREAREMOS EL TRIGGER PARA AUDITAR LOS MENUS

CREATE TABLE AUDITORIA_MENU(
    id NUMBER PRIMARY KEY,
    id_menu NUMBER,
    tipo_accion VARCHAR2(20),
    valor_antiguo VARCHAR2(50),
    valor_nuevo VARCHAR2(50),
    fecha DATE,
    usuario VARCHAR(50),
    FOREIGN KEY (id_menu) REFERENCES MENUS(id)
);


--CREAMOS LA TABLA STCOM INGREDIENTES

CREATE TABLE STOCK_INGREDIENTES(
    id_ingrediente NUMBER PRIMARY KEY,
    cantidad NUMBER(10,2) NOT NULL,
    unidad_medida VARCHAR2(10) NOT NULL,
    precio_unitario NUMBER(10,2) NOT NULL,
    stock_minimo NUMBER(10,2) DEFAULT 5,
    FOREIGN KEY (id_ingrediente) REFERENCES INGREDIENTES(id)
);






--TODOS LOS INSERT
-- Tipos de ingredientes
INSERT INTO TIPO_INGREDIENTES VALUES (1, 'Vegetales');
INSERT INTO TIPO_INGREDIENTES VALUES (2, 'Carnes');
INSERT INTO TIPO_INGREDIENTES VALUES (3, 'Lácteos');
INSERT INTO TIPO_INGREDIENTES VALUES (4, 'Granos y Pastas');
INSERT INTO TIPO_INGREDIENTES VALUES (5, 'Condimentos');
COMMIT;


-- Ahora insertemos ingredientes reales
INSERT INTO INGREDIENTES VALUES (1, 'Tomate', 1);
INSERT INTO INGREDIENTES VALUES (2, 'Lechuga', 1);
INSERT INTO INGREDIENTES VALUES (3, 'Cebolla', 1);
INSERT INTO INGREDIENTES VALUES (4, 'Pollo', 2);
INSERT INTO INGREDIENTES VALUES (5, 'Carne de Res', 2);
INSERT INTO INGREDIENTES VALUES (6, 'Queso', 3);
INSERT INTO INGREDIENTES VALUES (7, 'Leche', 3);
INSERT INTO INGREDIENTES VALUES (8, 'Arroz', 4);
INSERT INTO INGREDIENTES VALUES (9, 'Pasta', 4);
INSERT INTO INGREDIENTES VALUES (10, 'Sal', 5);
INSERT INTO INGREDIENTES VALUES (11, 'Aceite de Oliva', 5);
COMMIT;

--Insertamos el stock de ingredientes
-- OJO!!!! ACUERDATE DE QUE EN ESTA TABLA HICISTE DE QUE EL ID SEA EL ID DEL INGREDIENTE
-- Stock inicial de ingredientes (cantidad, unidad, precio, stock_mínimo)
INSERT INTO STOCK_INGREDIENTES VALUES (1, 25.5, 'kg', 1500, 10);  -- Tomate
INSERT INTO STOCK_INGREDIENTES VALUES (2, 15.0, 'kg', 1200, 8);   -- Lechuga
INSERT INTO STOCK_INGREDIENTES VALUES (3, 18.0, 'kg', 900, 10);   -- Cebolla
INSERT INTO STOCK_INGREDIENTES VALUES (4, 30.0, 'kg', 5500, 15);  -- Pollo
INSERT INTO STOCK_INGREDIENTES VALUES (5, 20.0, 'kg', 7800, 12);  -- Carne de Res
INSERT INTO STOCK_INGREDIENTES VALUES (6, 12.0, 'kg', 6500, 5);   -- Queso
INSERT INTO STOCK_INGREDIENTES VALUES (7, 40.0, 'L', 1000, 20);    -- Leche
INSERT INTO STOCK_INGREDIENTES VALUES (8, 50.0, 'kg', 1200, 20);  -- Arroz
INSERT INTO STOCK_INGREDIENTES VALUES (9, 35.0, 'kg', 1800, 15);  -- Pasta
INSERT INTO STOCK_INGREDIENTES VALUES (10, 10.0, 'kg', 500, 5);   -- Sal
INSERT INTO STOCK_INGREDIENTES VALUES (11, 8.5, 'L', 8500, 3);    -- Aceite
COMMIT;

--insercion de ingredientes y platillos
-- Relacionar ingredientes con platillos
-- Ensalada César (ID 10) usa: Lechuga, Tomate, Queso, Aceite
INSERT INTO INGREDIENTES_PLATILLOS VALUES (2, 10); -- Lechuga
INSERT INTO INGREDIENTES_PLATILLOS VALUES (1, 10); -- Tomate
INSERT INTO INGREDIENTES_PLATILLOS VALUES (6, 10); -- Queso
INSERT INTO INGREDIENTES_PLATILLOS VALUES (11, 10); -- Aceite

-- Pollo a la Plancha (ID 11) usa: Pollo, Sal, Aceite
INSERT INTO INGREDIENTES_PLATILLOS VALUES (4, 11); -- Pollo
INSERT INTO INGREDIENTES_PLATILLOS VALUES (10, 11); -- Sal
INSERT INTO INGREDIENTES_PLATILLOS VALUES (11, 11); -- Aceite

-- Pasta Alfredo (ID 12) usa: Pasta, Queso, Leche
INSERT INTO INGREDIENTES_PLATILLOS VALUES (9, 12); -- Pasta
INSERT INTO INGREDIENTES_PLATILLOS VALUES (6, 12); -- Queso
INSERT INTO INGREDIENTES_PLATILLOS VALUES (7, 12); -- Leche

COMMIT;